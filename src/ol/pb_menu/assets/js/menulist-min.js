(function(e){"use strict";var t={$modalHolder:"",$form:"",$requestUrl:"",$modalOpen:!1,$newTask:{},$root_id:"",init:function(){this.$modalHolder=e("#modal_append_task"),this.$requestUrl=appendTaskUrl,this._registerEventListener()},_registerEventListener:function(){e(document).on("create-list-item",e.proxy(this._getForm,this)),e(document).on("update-list-item",e.proxy(this._getEditForm,this))},_getEditForm:function(t,n){var r=updateTreeUrl+"/id/"+n,i=this;e.ajax({url:r,type:"POST"}).done(function(e){i._addFormBody(e,"#menu-list-config-_form_edit_list-form","Config bearbeiten")}).error(function(){console.error(r+" missmatch!")})},_getForm:function(t,n){this.$root_id=n;var r=this;e.ajax({url:r.$requestUrl+"/root_id/"+r.$root_id,type:"POST"}).done(function(e){r._addFormBody(e,"#todo-list-task-_form_todolisttask-form","Neuen Menüpunkt hinzufügen")}).error(function(){})},_addFormBody:function(t,n,r){this.$modalHolder.children(".modal-header").children("h3").text(r),this.$modalHolder.children(".modal-body").children("#append").html(t),this.$form=e(n),this.$modalOpen||this._openForm(),this._registerFormEvent()},_openForm:function(){var e=this;this.$modalHolder.modal(),this.$modalHolder.on("shown",function(){e.$modalOpen=!0}),this.$modalHolder.on("hide",function(){e.$modalOpen=!1})},_registerFormEvent:function(){var t=this;this.$form.on("submit",function(n){n.preventDefault(),t.$newTask=e(this).serialize(),t._sendForm(t.$newTask,e(this).attr("action"))})},_sendForm:function(t,n){var r=this;e.ajax({url:n,type:"POST",data:t}).done(function(t){if(r._isJson(t)){t=e.parseJSON(t),console.log(t.redirect),r.$modalHolder.modal("hide"),window.location.href=t.redirect;return}r._addFormBody(t),r._registerFormEvent()}).error(function(){console.error("failed")})},_isJson:function(t){var n=!0;try{e.parseJSON(t)}catch(r){n=!1}return n}};e(function(){t.init()})})(jQuery),function(e){"use strict";var t={$list:"",init:function(){this.$list=e("ol.sortable"),e(this.$list).nestedSortable({handle:"div",items:"li",toleranceElement:"> div",helper:"clone",isTree:!0,expandOnHover:700,startCollapsed:!0,placeholder:"placeholder",revert:250,tabSize:25}),this._registerEventListener()},_registerEventListener:function(){e(document).on("task-save",e.proxy(this._getArray,this)),e(document).on("append-new-item-to-list",e.proxy(this._getArray,this))},_getArray:function(){var e=this.$list.nestedSortable("toArray",{startDepthCount:0});this._update(e)},dump:function(e,t){var n=this,r="";t||(t=0);var i="";for(var s=0;s<t+1;s++)i+="    ";if(typeof e=="object")for(var o in e){var u=e[o];typeof u=="object"?(r+=i+"'"+o+"' ...\n",r+=n.dump(u,t+1)):r+=i+"'"+o+"' => \""+u+'"\n'}else r="===>"+e+"<===("+typeof e+")";return r},_update:function(t){var n={sorted_list:t},r=this;e.ajax({url:updateListSortingUrl,type:"POST",data:n,dataType:"json"}).done(function(t){t=r.dump(t),typeof e("#toArrayOutput")[0].textContent!="undefined"?e("#toArrayOutput")[0].textContent=t:e("#toArrayOutput")[0].innerText=t}).error(function(){console.log(updateTreeUrl,"smothing missmatch")})},_appendNewItem:function(e,t,n){}};e(function(){t.init()})}(jQuery);